django-generic-tasks
====================

Active Job for Django

Example usage
-------------

.. include:: django_generic_tasks_example/my_app/tasks.py
  :code:

Registering tasks
-----------------

Similar to `signals <https://docs.djangoproject.com/en/4.0/topics/signals/#connecting-receiver-functions-1>`_, tasks have
to be implicitly registered by ensuring they are imported during application startup. This can be done in the ``ready``
method in an application's ``AppConfig``.

`my_app/apps.py <django_generic_tasks_example/my_app/apps.py>`_

.. include:: django_generic_tasks_example/my_app/apps.py
  :code:

HTTP endpoints
--------------

``django-generic-tasks`` uses `django-ninja <https://django-ninja.rest-framework.com/>`_ to automatically expose API endpoints for running tasks. Each defined task
gets its own API
endpoint and uses the specified Pydantic ``BaseModel`` for parameter verification.

.. image:: https://user-images.githubusercontent.com/11734309/165979039-df4d2bfe-4c38-4798-af2e-fd0792303608.png
  :alt: autogenerated OpenAPI docs

Example configuration
~~~~~~~~~~~~~~~~~~~~~

Create your own ``NinjaAPI`` instance and mount ``django_generic_tasks.api.router``.

`django_generic_tasks_example/api.py <django_generic_tasks_example/django_generic_tasks_example/api.py>`_

.. include:: django_generic_tasks_example/django_generic_tasks_example/api.py
  :code:

Add your `NinjaAPI` instance in `urls.py`:

`django_generic_tasks_example/urls.py <django_generic_tasks_example/django_generic_tasks_example/urls.py>`_

.. include:: django_generic_tasks_example/django_generic_tasks_example/urls.py
  :code:
  :start-line: 15

Supported backends
------------------

ThreadingBackend
~~~~~~~~~~~~~~~~

Runs tasks in a new ``threading.Thread``.

CloudTasksBackend
~~~~~~~~~~~~~~~~~

Runs tasks using `Cloud Tasks <https://cloud.google.com/tasks>`_ `HTTP Target tasks <https://cloud.google.com/tasks/docs/creating-http-target-tasks>`_.

Configuration
-------------

``TASKS_API_AUTHENTICATION``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Specifies what authentication should be required to run tasks via HTTP.

Type: ``Optional[str]``

Supported values:

* ``"oidc"`` - Require API requests to contain a valid Google-issued OIDC token
* ``None`` (default) - No authentication

``TASKS_BACKEND``
~~~~~~~~~~~~~~~~~

The default backend to use to run tasks asynchronously.

Type: any class which implements the ``django_generic_tasks.backends.Backend`` protocol
